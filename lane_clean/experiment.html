<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3.js GeoJSON Example</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>

<script>
    // GeoJSON数据
    Promise.all([d3.json("new_id_mapping.json"), d3.json("lane_v3.geojson"),d3.json("boundary.geojson")]).then(function (loadData) {
    var idMapping = loadData[0];
    var lanejson =loadData[1];
    var geojson = loadData[2];
    // 设置SVG画布大小
    var width = 500;
    var height = 500;
    

    var customColors = [
    "#e6194b", "#3cb44b", "#ffe119", "#4363d8", "#f58231", 
    "#911eb4", "#46f0f0", "#f032e6", "#bcf60c", "#fabebe", 
    "#008080", "#e6beff", "#9a6324", "#800000", "#aaffc3", 
    "#808000", "#ffd8b1", "#000075", "#808080", "#aa6e28", 
    "#fff000", "#000080", "#aa5500", "#00aa55", "#00aaaa", 
    "#00aaaa", "#aa00aa", "#aaaa00", "#0055aa", "#aa0055"
];


    // 创建颜色比例尺
    var fidColorScale = d3.scaleOrdinal()
        .domain(Object.keys(idMapping))
        .range(customColors);

    // 创建SVG元素
    var svg = d3.select("body")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

    // 创建投影
    var projection = d3.geoIdentity();

    // 创建路径生成器
    var path = d3.geoPath().projection(projection);

    // 计算缩放和平移以适应所有特征
    var bounds = d3.geoBounds(geojson);
    var scale = 0.95 / Math.max((bounds[1][0] - bounds[0][0]) / width, (bounds[1][1] - bounds[0][1]) / height);
    var translate = [(width - scale * (bounds[1][0] + bounds[0][0])) / 2, (height - scale * (bounds[1][1] + bounds[0][1])) / 2];
    projection.scale(scale).translate(translate);
    var tooltip = d3.select("body").append("div")
        .attr("class", "tooltip")   
        .style("opacity", 0);


        svg.selectAll(".lane-path")
        .data(lanejson.features)
        .enter()
        .append("path")
        .attr("class", "lane-path")
        .attr("d", function (d) {
            return path(d.geometry);
        })
        .attr("stroke-width", 0.5)
        //.attr("stroke", "black")
        .attr("stroke", function(d) {
                // 使用ID映射来决定颜色
                return fidColorScale(idMapping[d.properties.fid.toString()]);
            })
        .attr("fill", "none")
        .attr("fid", function (d) {
            return d.properties.fid;
        })
        .attr("left_b_id", function (d) {return d.properties.left_boundary_id;})
        .attr("right_b_id", function (d) {return d.properties.right_boundary_id;})
        .on('mouseover',(event,d) =>{
            console.log(d);
        })
        ;
 
        
    })
</script>

</body>
</html>